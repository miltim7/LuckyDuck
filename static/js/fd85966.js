(window.webpackJsonp=window.webpackJsonp||[]).push([[72],{1206:function(e,t,n){e.exports=n.p+"img/6378aca.png"},1392:function(e,t,n){"use strict";n.r(t);n(2),n(4),n(3),n(5),n(1),n(6);var r=n(14),o=n(11),c=(n(30),n(0),n(19),n(18),n(56),n(32),n(55),n(7),n(17)),l=n(172),d=n(41);function m(object,e){var t=Object.keys(object);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(object);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(object,e).enumerable}))),t.push.apply(t,n)}return t}function v(e){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?m(Object(source),!0).forEach((function(t){Object(o.a)(e,t,source[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(source)):m(Object(source)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(source,t))}))}return e}var f={name:"LoginModal",components:{IconRoundArrowRight:function(){return Promise.resolve().then(n.t.bind(null,785,7))},IconWarning:function(){return Promise.resolve().then(n.t.bind(null,780,7))}},data:function(){return{isSignIn:!0,processing:!1}},computed:v(v(v({},Object(c.c)({signInMethods:"authorization/getAuthorizationMethods",signUpMethods:"authorization/getRegistrationMethods"})),Object(c.e)({windowSize:function(e){return e.page.windowSize},source:function(e){return e.source.uuid}})),{},{isMobile:function(){return this.windowSize<=768},methods:function(){return this.isSignIn?this.signInMethods:this.signUpMethods},generalMethods:function(){return this.methods.slice(0,4)},extraMethods:function(){return this.methods.slice(4)}}),methods:v(v({},Object(c.b)({setToken:"user/setToken",loadUser:"user/loadUser"})),{},{onBeforeOpen:function(e){var t=e.params;this.isSignIn=!t||void 0===t.isSignIn||t.isSignIn},onBeforeClose:function(){this.removeWindowMessageListener()},goToSignUp:function(){this.processing||(this.isSignIn=!1)},goToSignIn:function(){this.processing||(this.isSignIn=!0)},onSignIn:function(e){var t=this;return Object(r.a)(regeneratorRuntime.mark((function n(){var r,o;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!t.processing){n.next=2;break}return n.abrupt("return");case 2:if(t.processing=!0,(r=window.open("/loading","_blank")).blur(),window.focus(),o=null,!t.$fpjs){n.next=17;break}return n.prev=8,n.next=11,t.$fpjs.getVisitorData();case 11:o=n.sent,n.next=17;break;case 14:n.prev=14,n.t0=n.catch(8),o=null;case 17:return n.next=19,t.$api.auth.login({provider:e,source:t.source,language:t.$i18n.locale,timezone:t.$DateTime.local().offset,userzone:o&&o.visitorId?o.visitorId:null}).then((function(e){t.initWindowMessageListener(),r.location.replace(e.data.url),r.focus(),window.blur()})).catch((function(e){var n;(t.removeWindowMessageListener(),r.close(),e.error.attributes)&&(e.error.attributes.provider&&e.error.attributes.provider.length?n=e.error.attributes.provider[0]:e.error.attributes.source&&e.error.attributes.source.length?n=e.error.attributes.source[0]:e.error.attributes.language&&e.error.attributes.language.length?n=e.error.attributes.language[0]:e.error.attributes.timezone&&e.error.attributes.timezone.length&&(n=e.error.attributes.timezone[0]),t.$noty({title:t.$t("notifications.fail"),text:n,type:"error"}));t.processing=!1}));case 19:case"end":return n.stop()}}),n,null,[[8,14]])})))()},initWindowMessageListener:function(){window.addEventListener("message",this.onWindowMessage,!1)},removeWindowMessageListener:function(){window.removeEventListener("message",this.onWindowMessage)},onWindowMessage:function(e){var t=this;return Object(r.a)(regeneratorRuntime.mark((function n(){var o,c,m,v;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(o=!1,e.data&&e.data.initiator&&"luckyduck"===e.data.initiator){n.next=3;break}return n.abrupt("return");case 3:if(n.prev=3,(c=e.data).status){n.next=8;break}return t.$noty({title:t.$t("notifications.fail"),text:c.error.message,type:"error"}),n.abrupt("return");case 8:if(!c.data.redirect){n.next=14;break}return o=!0,m=Object(d.a)({rt:c.data.redirect.token}),v="".concat(c.data.redirect.target,"/?").concat(m),window.location.replace(v),n.abrupt("return");case 14:return n.next=16,t.setToken({token:c.data.token.hash,maxAge:c.data.token.expiration});case 16:return n.next=18,t.loadUser().then(function(){var e=Object(r.a)(regeneratorRuntime.mark((function e(n){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:c.data.is_registration&&t.$noty({title:t.$t("notifications.success"),text:t.$t("notifications.successRegistered"),type:"success"}),t.$modal.hide("loginModal"),n.data.account.status===l.a.Banned&&t.$modal.show("accountBannedModal");case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).catch((function(){t.$noty({title:t.$t("notifications.fail"),text:t.$t("notifications.notAuthorized"),type:"error"})}));case 18:n.next=22;break;case 20:n.prev=20,n.t0=n.catch(3);case 22:return n.prev=22,o||(t.processing=!1),t.removeWindowMessageListener(),n.finish(22);case 26:case"end":return n.stop()}}),n,null,[[3,20,22,26]])})))()}})},h=f,w=n(10),component=Object(w.a)(h,(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("vModal",{attrs:{classes:["login-modal"],name:"loginModal",width:700,"max-width":e.isMobile?420:1/0,image:e.isMobile?null:n(1206),processing:e.processing,closable:!e.processing},on:{"before-open":e.onBeforeOpen,"before-close":e.onBeforeClose},scopedSlots:e._u([{key:"topbar",fn:function(){return[r("div",{staticClass:"login-modal-warn"},[r("div",{staticClass:"login-modal-warn__message",domProps:{innerHTML:e._s(e.$t("modals.login.warn"))}}),e._v(" "),r("IconWarning")],1)]},proxy:!0},{key:"title",fn:function(){return[e.isSignIn?[e._v(e._s(e.$t("modals.login.title.signIn")))]:[e._v(e._s(e.$t("modals.login.title.signUp")))]]},proxy:!0}])},[e._v(" "),e._v(" "),r("div",{staticClass:"login-methods-wrapper"},[e.isSignIn?r("p",[e._v(e._s(e.$t("modals.login.methods.signIn")))]):r("p",[e._v(e._s(e.$t("modals.login.methods.signUp")))]),e._v(" "),r("div",{staticClass:"login-basic-methods"},e._l(e.generalMethods,(function(t,n){return r("div",{key:n,class:["login-basic-methods__item","login-basic-methods__item_"+t.provider,{"login-basic-methods__item_disabled":e.processing}],on:{click:function(n){return e.onSignIn(t.provider)}}},[r("vIcon",{attrs:{name:"socials/simple/"+t.provider}}),e._v(" "),r("span",[e._v(e._s(e.$t("authorization.providers."+t.provider)))])],1)})),0)]),e._v(" "),r("div",{staticClass:"login-methods-wrapper"},[r("p",[e._v(e._s(e.$t("modals.login.methods.alternate")))]),e._v(" "),r("div",{staticClass:"login-extra-methods"},e._l(e.extraMethods,(function(t,n){return r("div",{directives:[{name:"tooltip",rawName:"v-tooltip",value:e.processing?null:e.$t("authorization.providers."+t.provider),expression:"processing ? null : $t(`authorization.providers.${ method.provider }`)"}],key:n,class:["login-extra-methods__item",{"login-extra-methods__item_disabled":e.processing}],on:{click:function(n){return e.onSignIn(t.provider)}}},[r("vIcon",{attrs:{name:"socials/color/"+t.provider}})],1)})),0)]),e._v(" "),r("div",{staticClass:"login-agreement"},[r("p",{domProps:{innerHTML:e._s(e.$t("modals.login.agreement.text",{action:e.isSignIn?e.$t("modals.login.agreement.actionSignIn"):e.$t("modals.login.agreement.actionSignUp")}))}})]),e._v(" "),r("div",{staticClass:"login-mode"},[e.isSignIn?r("p",[e._v("\n      "+e._s(e.$t("modals.login.mode.signIn"))+"\n\n      "),r("strong",{on:{click:e.goToSignUp}},[e._v("\n        "+e._s(e.$t("modals.login.title.signUp"))+"\n        "),r("IconRoundArrowRight")],1)]):r("p",[e._v("\n      "+e._s(e.$t("modals.login.mode.signUp"))+"\n\n      "),r("strong",{on:{click:e.goToSignIn}},[e._v("\n        "+e._s(e.$t("modals.login.title.signIn"))+"\n        "),r("IconRoundArrowRight")],1)])])])}),[],!1,null,null,null);t.default=component.exports}}]);